@page "/game/play/{GameId}"
@using Sqids

@inject SqidsEncoder<int> Hasher
@inject IDbContextFactory<ApplicationDbContext> DbContextFactory
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager

@layout Layout.MobileLayout

@rendermode InteractiveServer

<PageTitle>Play Game</PageTitle>
@if (_game == null)
{
    <MudOverlay DarkBackground Absolute>
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" Size="Size.Large" />
    </MudOverlay>
}
else
{
        Team team1 = _game.Teams?[0]!;
        Team team2 = _game.Teams?[1]!;

    <MudText Typo="Typo.h4" Align="Align.Center">@team1.Name <MudChip T="string" Color="Color.Info" Class="ml-2">@(_game.Shots.Where(s => s.ShootingTeam.Id == team1.Id).Count()) shot(s)</MudChip></MudText>
    <BeerPongBoardLayout @bind-Cups="team1.Cups" CupSizeTemplate="team1.Board.InitialPositions" OnCupSelected="(cup) => CupClicked(cup, team1)" />
        <MudToolBar Gutters="false">
            <MudSpacer />
            <MudButton Variant="Variant.Filled" Class="mr-4" OnClick="MissedShot">Missed Shot</MudButton>
            <MudButton Variant="Variant.Filled">Player Stats</MudButton>
            <MudMenu Icon="@Icons.Material.Filled.MoreVert" Color="Color.Primary">
                <MudMenuItem>Rerack Cups</MudMenuItem>
                <MudMenuItem>Shot History</MudMenuItem>
                <MudMenuItem>End Game</MudMenuItem>
            </MudMenu>

            <MudSpacer />
        </MudToolBar>

        <BeerPongBoardLayout @bind-Cups="team2.Cups" CupSizeTemplate="team2.Board.InitialPositions" OnCupSelected="(cup) => CupClicked(cup, team2)" Reverse />
    <MudText Typo="Typo.h4" Align="Align.Center">@team2.Name  <MudChip T="string" Color="Color.Info" Class="ml-2">@(_game.Shots.Where(s => s.ShootingTeam.Id == team2.Id).Count()) shot(s)</MudChip></MudText>
}

